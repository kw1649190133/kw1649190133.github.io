

<!DOCTYPE html>
<html lang="CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Kwindy">
  <meta name="keywords" content="">
  
    <meta name="description" content="前言最近突然接到个管网处理的项目，需要处理excel表格，计算各种数据，也是紧急捡起了python，边做边学。现在终于有时间喘口气，写一写笔记。大致说明一下雨污管网的逻辑。雨污管网一般是靠重力使水流动，所以垂直方向上需要满足一定的斜率。平面结构一般为多叉树状结构，水流一般是从分叉多的部分流向分叉少的部分，最终汇集到一起进行处理。 程序的框架设计当我们只是需要程序作为一个工具去解决具体问题的时候，是">
<meta property="og:type" content="article">
<meta property="og:title" content="python开发雨污管网工具">
<meta property="og:url" content="http://kw1649190133.github.io/2025/09/30/python%E5%BC%80%E5%8F%91%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E5%B7%A5%E5%85%B7/index.html">
<meta property="og:site_name" content="kw&#39;s blog">
<meta property="og:description" content="前言最近突然接到个管网处理的项目，需要处理excel表格，计算各种数据，也是紧急捡起了python，边做边学。现在终于有时间喘口气，写一写笔记。大致说明一下雨污管网的逻辑。雨污管网一般是靠重力使水流动，所以垂直方向上需要满足一定的斜率。平面结构一般为多叉树状结构，水流一般是从分叉多的部分流向分叉少的部分，最终汇集到一起进行处理。 程序的框架设计当我们只是需要程序作为一个工具去解决具体问题的时候，是">
<meta property="og:locale">
<meta property="og:image" content="http://kw1649190133.github.io/2025/09/30/python%E5%BC%80%E5%8F%91%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E5%B7%A5%E5%85%B7/813bb752ff9a25f2d29a3b03ba95d5ad.png">
<meta property="og:image" content="http://kw1649190133.github.io/2025/09/30/python%E5%BC%80%E5%8F%91%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E5%B7%A5%E5%85%B7/670191cfad10c4ed68ba168ccb34ac83.png">
<meta property="article:published_time" content="2025-09-30T07:40:04.000Z">
<meta property="article:modified_time" content="2025-09-30T09:03:52.739Z">
<meta property="article:author" content="Kwindy">
<meta property="article:tag" content="python">
<meta property="article:tag" content="开发">
<meta property="article:tag" content="工具">
<meta property="article:tag" content="雨污管网">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://kw1649190133.github.io/2025/09/30/python%E5%BC%80%E5%8F%91%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E5%B7%A5%E5%85%B7/813bb752ff9a25f2d29a3b03ba95d5ad.png">
  
  
  
  <title>python开发雨污管网工具 - kw&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"kw1649190133.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Startseite</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archiv</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Kategorien</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Schlagwörter</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>Über</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="python开发雨污管网工具"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-09-30 15:40" pubdate>
          September 30, 2025 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          16k wörter
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          131 minuten
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">python开发雨污管网工具</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近突然接到个管网处理的项目，需要处理excel表格，计算各种数据，也是紧急捡起了python，边做边学。现在终于有时间喘口气，写一写笔记。<br>大致说明一下雨污管网的逻辑。雨污管网一般是靠重力使水流动，所以垂直方向上需要满足一定的斜率。平面结构一般为多叉树状结构，水流一般是从分叉多的部分流向分叉少的部分，最终汇集到一起进行处理。</p>
<h1 id="程序的框架设计"><a href="#程序的框架设计" class="headerlink" title="程序的框架设计"></a>程序的框架设计</h1><p>当我们只是需要程序作为一个工具去解决具体问题的时候，是无所谓框架不框架的，代码能跑就没问题，只要把控好输入与输出，中间怎么样其实没人关心。<br>但是当代码越来越多，项目越来越复杂的时候，考虑到便于管理、维护、团队协作的问题，就不能让代码几千行一本道运行到底，必须对各种功能进行拆分，避免代码不断调整的过程中，一处错误对所有的代码进行影响。<br>代码文件结构使用一层分叉结构，一个主函数和一个用来装模块的modules文件夹。<br>main.py<br>modules<br>㇗功能模块1.py<br>㇗功能模块2.py</p>
<h1 id="主界面程序的设计"><a href="#主界面程序的设计" class="headerlink" title="主界面程序的设计"></a>主界面程序的设计</h1><p>主界面的设计是直接描述了一下丢给AI生成的，使用最简单的结构，一个class就包完了界面显示、按键功能和模块调用。最好是在一开始就考虑程序需要设计成怎样的规模，再选择合适的结构复杂度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span>(tk.Tk):<br>    <span class="hljs-string">&quot;&quot;&quot;主应用程序窗口&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 添加时间处理函数所需的模块</span><br>    <span class="hljs-keyword">import</span> time<br>    <br>    <span class="hljs-comment"># 创建并运行应用程序</span><br>    app = Application()<br>    app.mainloop()<br></code></pre></td></tr></table></figure>

<h2 id="子模块的主函数设计"><a href="#子模块的主函数设计" class="headerlink" title="子模块的主函数设计"></a>子模块的主函数设计</h2><p>子模块在功能设计完成后，最好是将代码都放到函数中，便于整理和调用。好像还可以进一步放到类中，但可惜我并没有那么高的编码水平。<br>封装到函数中之后，通过<code>if __name__ == &quot;__main__&quot;:</code>，设置一个直接运行模块时的直接调用，这样就既可以直接运行模块，也可以通过其他程序调用模块。便于调试与合作开发。</p>
<p>以MDB数据库制图的模块为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 功能封装</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">MDB_plot</span>(<span class="hljs-params">input_path</span>):<br>    <span class="hljs-keyword">try</span>:<br>        mdb_file = input_path<br>        output_folder = visualize_drainage_network(mdb_file)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;可视化结果保存在: <span class="hljs-subst">&#123;output_folder&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;错误: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    mdb_file = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;输入MDB数据库文件路径: &quot;</span>).strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(mdb_file):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;文件不存在，请检查路径&quot;</span>)<br>    MDB_plot(mdb_file)<br><br></code></pre></td></tr></table></figure>

<h2 id="调用子模块中的方法"><a href="#调用子模块中的方法" class="headerlink" title="调用子模块中的方法"></a>调用子模块中的方法</h2><p>MDB_plot模块是放在<code>../modules/MDB_plot.py</code>路径下的，首先要通过from和import指令接入路径，接着使用MDB_plot.MDB_plot(参数)就可以实现跨文件的函数调用。这里在主界面程序中定义了一个MDB_plot_inmain函数，通过它来调用其他文件中的功能模块，和实现与数据框显示信息的联动，这个函数是设置在外层的。<br>而主程序类app中，又定义了一个执行MDB_plot功能的函数，它实现的是当鼠标点击执行按钮后，创建一个新进程来执行函数，并且将文本框中的文件作为输入参数放到功能函数中执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">sys.path.append(os.path.dirname(os.path.abspath(__file__)))<br><span class="hljs-keyword">from</span> modules <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">MDB_plot_inmain</span>(<span class="hljs-params">input_path, log_callback</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;执行MDB管线图绘制&quot;&quot;&quot;</span><br>    log_callback(<span class="hljs-string">f&quot;MDB管线图绘制&quot;</span>)<br>    log_callback(<span class="hljs-string">f&quot;输入文件: <span class="hljs-subst">&#123;input_path&#125;</span>&quot;</span>)<br>    <span class="hljs-comment"># 功能模块导入</span><br>    MDB_plot.MDB_plot(input_path)<br>    log_callback(<span class="hljs-string">&quot;管线图绘制完成，结果保存到mdb路径下plot文件夹&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span>(tk.Tk):<br>    <span class="hljs-string">&quot;&quot;&quot;主应用程序窗口&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_mdb_plot</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;执行MDB管线图绘制&quot;&quot;&quot;</span><br>        input_path = self.input_entry_tab10.get()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> input_path:<br>            self.log(<span class="hljs-string">&quot;错误: 请选择MDB输入文件!&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        <br>        <span class="hljs-comment"># 启动新线程执行任务</span><br>        threading.Thread(<br>            target=MDB_plot_inmain,<br>            args=(input_path, self.log),<br>            daemon=<span class="hljs-literal">True</span><br>        ).start()<br><br></code></pre></td></tr></table></figure>

<h1 id="各种功能函数"><a href="#各种功能函数" class="headerlink" title="各种功能函数"></a>各种功能函数</h1><h2 id="Excel相关"><a href="#Excel相关" class="headerlink" title="Excel相关"></a>Excel相关</h2><h3 id="xlrd库"><a href="#xlrd库" class="headerlink" title="xlrd库"></a>xlrd库</h3><p>一开始使用Python2.7，只能使用自带的xlrd库来读取。xlrd只能读取xls，而如果要写入文件，还需要xlwt库。但是后面为了方便，转去使用openpyxl库了。这里简单记录一下使用方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python2">import xlrd<br><br># 读取文件路径，提取表格薄<br>input_path = &quot;D:/表格路径.xls&quot;<br>workbook = xlrd.open_workbook(input_path)<br><br># 打印获取的所有sheet表名称<br>print(&#x27;__Loading__&#x27;)<br>print(&#x27;ALL sheets: %s&#x27; % workbook1.sheet_names())<br><br># 获取第一个sheet表<br>sheet1 = workbook.sheet_by_index(1)<br># 获取表格行数<br>sheet1row = sheet1.nrows<br><br>print(&#x27;循环表格&#x27;)<br>for i in range(2,sheet1.nrows):<br>    print sheet1.row(i)[1].value<br><br></code></pre></td></tr></table></figure>

<p>需要注意的是，这里的<code>sheet1.row(i)[1]</code>是从0开始的，也就是<code>sheet1.row(0)[0]</code>才是第一行第一列。这一点与openpyxl库是不一样的。</p>
<h3 id="openpyxl库"><a href="#openpyxl库" class="headerlink" title="openpyxl库"></a>openpyxl库</h3><p>使用openpyxl库需要先安装<code>pip install openpyxl</code><br>openpyxl库可以读取xlsx格式表格，但也只能读取这种格式。以后如果有复杂需求，还得考虑其他更具泛用性的库。<br>这里还做了一个异常处理机制，例如我只需要获取表格薄中名为W的表格，如果存在则获取表格，如果找不到就提示未找到。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import openpyxl<br><br>input_path2 = <span class="hljs-string">&quot;D:\work\管网检查项目\设计与施工对比表\\7.9秀陇村+溪心村\\06秀陇村-设计-次支管网_load.xlsx&quot;</span><br><span class="hljs-attribute">output_path</span>=None<br><br><span class="hljs-comment"># 自动决定输出文件名</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> output_path:<br>    <span class="hljs-keyword">if</span> input_path2.endswith(<span class="hljs-string">&#x27;.xlsx&#x27;</span>):<br>        output_path = input_path2.replace(<span class="hljs-string">&#x27;.xlsx&#x27;</span>, <span class="hljs-string">&#x27;_processed.xlsx&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        output_path = input_path2 + <span class="hljs-string">&#x27;_processed.xlsx&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><span class="hljs-comment"># 读取文件</span><br>    workbook2 = openpyxl.load_workbook(input_path2)<br>    sheet_names2 = workbook2.sheetnames # 表格薄的表格名单<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;W&quot;</span> <span class="hljs-keyword">in</span> sheet_names2 :<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__Loading W sheet__&#x27;</span>)<br>        sheet2w = workbook2[<span class="hljs-string">&quot;W&quot;</span>] # 按名称获取<br>        #数据处理<br>        <span class="hljs-attribute">sheet2w</span>=sheet_link(sheet2w)<br>        # 自动填写公式<br>        <span class="hljs-attribute">sheet2w</span>=fill_conditional_formulas(sheet2w)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;W表自动公式填写完成&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;设计数据未找到W表&quot;</span>)<br>    # 保存结果<br>    workbook2.save(output_path)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;———————————分割线———————————&quot;</span>)<br>    <span class="hljs-built_in">print</span>(f<span class="hljs-string">&quot;处理完成！结果已保存到: &#123;output_path&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="pandas库"><a href="#pandas库" class="headerlink" title="pandas库"></a>pandas库</h3><p>pandas库虽然可以兼容xlsx和xls，但是它也有相应的问题，首先就是版本不匹配。</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br></code></pre></td></tr></table></figure>

<h4 id="关于使用pandas库的错误"><a href="#关于使用pandas库的错误" class="headerlink" title="关于使用pandas库的错误"></a>关于使用pandas库的错误</h4><p>错误描述：<code>ValueError: numpy.dtype size changed, may indicate binary incompatibility. Expected 96”</code><br>使用默认的python环境大概率会遇到版本不匹配的报错问题，因为pandas库和最新的numpy是不匹配的。比较好的方式是使用大佬打包好的numpy和pandas不冲突的环境，但是找起来比较麻烦。比较简单发办法还是<code>pip install numpy==1.26.4</code>，直接把版本改低。</p>
<h2 id="一些模块化的功能"><a href="#一些模块化的功能" class="headerlink" title="一些模块化的功能"></a>一些模块化的功能</h2><p>这里的功能主要还是openpyxl库的实现的。</p>
<h3 id="表格自动填写公式"><a href="#表格自动填写公式" class="headerlink" title="表格自动填写公式"></a>表格自动填写公式</h3><p>直接拿项目中的代码来记录，有时候需要再单元格中填写公式而不是数值，通过这种方法可以直接在表格中根据需要自动填写公式，比自己拉表方便多了。看格式就知道这是AI写的，AI真方便哈哈。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 自动填公式</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fill_conditional_formulas</span>(<span class="hljs-params">sheet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    智能填充公式（仅当引用单元格非空时）：</span><br><span class="hljs-string">    - M列：计算二维距离 =((I-D)^2+(H-C)^2)^0.5</span><br><span class="hljs-string">    - N列：计算差值 =J-E</span><br><span class="hljs-string">    - O列：计算差值 =K-F</span><br><span class="hljs-string">    - P列：计算差值 =L-G</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">    sheet: openpyxl的Worksheet对象</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 列字母到索引的映射（A=1, B=2,...）</span><br>    col_map = &#123;<span class="hljs-string">&#x27;C&#x27;</span>:<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;D&#x27;</span>:<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;E&#x27;</span>:<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;F&#x27;</span>:<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;G&#x27;</span>:<span class="hljs-number">7</span>, <br>               <span class="hljs-string">&#x27;H&#x27;</span>:<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;I&#x27;</span>:<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;J&#x27;</span>:<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;K&#x27;</span>:<span class="hljs-number">11</span>, <span class="hljs-string">&#x27;L&#x27;</span>:<span class="hljs-number">12</span>&#125;<br>    <br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, sheet.max_row + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 检查M列公式所需单元格是否非空</span><br>        <span class="hljs-keyword">if</span> (sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;I&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> \<br>           sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;D&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> \<br>           sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;H&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> \<br>           sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;C&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>):         <br>            sheet[<span class="hljs-string">f&#x27;M<span class="hljs-subst">&#123;row&#125;</span>&#x27;</span>] = <span class="hljs-string">f&quot;=round(((I<span class="hljs-subst">&#123;row&#125;</span>-D<span class="hljs-subst">&#123;row&#125;</span>)^2+(H<span class="hljs-subst">&#123;row&#125;</span>-C<span class="hljs-subst">&#123;row&#125;</span>)^2)^0.5,3)&quot;</span><br>        <span class="hljs-comment"># 检查N列公式所需单元格</span><br>        <span class="hljs-keyword">if</span> (sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;J&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> \<br>           sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;E&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>):<br>            <br>            sheet[<span class="hljs-string">f&#x27;N<span class="hljs-subst">&#123;row&#125;</span>&#x27;</span>] = <span class="hljs-string">f&quot;=J<span class="hljs-subst">&#123;row&#125;</span>-E<span class="hljs-subst">&#123;row&#125;</span>&quot;</span>   <br>        <span class="hljs-comment"># 检查O列公式所需单元格</span><br>        <span class="hljs-keyword">if</span> (sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;K&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> \<br>           sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;F&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>):<br>            <br>            sheet[<span class="hljs-string">f&#x27;O<span class="hljs-subst">&#123;row&#125;</span>&#x27;</span>] = <span class="hljs-string">f&quot;=K<span class="hljs-subst">&#123;row&#125;</span>-F<span class="hljs-subst">&#123;row&#125;</span>&quot;</span><br>        <span class="hljs-comment"># 检查P列公式所需单元格</span><br>        <span class="hljs-keyword">if</span> (sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;L&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> \<br>           sheet.cell(row=row, column=col_map[<span class="hljs-string">&#x27;G&#x27;</span>]).value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>):<br>            <br>            sheet[<span class="hljs-string">f&#x27;P<span class="hljs-subst">&#123;row&#125;</span>&#x27;</span>] = <span class="hljs-string">f&quot;=L<span class="hljs-subst">&#123;row&#125;</span>-G<span class="hljs-subst">&#123;row&#125;</span>&quot;</span><br>    <span class="hljs-keyword">return</span> sheet<br></code></pre></td></tr></table></figure>

<h3 id="自动美化表格"><a href="#自动美化表格" class="headerlink" title="自动美化表格"></a>自动美化表格</h3><p>这个是真的实用，处理完数据后自动把表格美化一下，统一字体字高，位置居中还有画边框，直接出成果一步到位。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 表格美化</span><br>def format_sheet(sheet):<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">    统一格式化工作表：</span><br><span class="hljs-string">    1. 字体：Calibri 10</span><br><span class="hljs-string">    2. 对齐：上下左右居中</span><br><span class="hljs-string">    3. 边框：A-P列，从第1行到最后一行添加线框</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">    sheet: openpyxl的Worksheet对象</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    返回:</span><br><span class="hljs-string">    格式化后的Worksheet对象</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>    # 定义字体样式<br>    font = Font(<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;Calibri&#x27;</span>, <span class="hljs-attribute">size</span>=10)<br>    <br>    # 定义对齐样式<br>    alignment = Alignment(<span class="hljs-attribute">horizontal</span>=<span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-attribute">vertical</span>=<span class="hljs-string">&#x27;center&#x27;</span>)<br>    <br>    # 定义边框样式（细线）<br>    thin_border = Border(<br>        <span class="hljs-attribute">left</span>=Side(style=&#x27;thin&#x27;),<br>        <span class="hljs-attribute">right</span>=Side(style=&#x27;thin&#x27;),<br>        <span class="hljs-attribute">top</span>=Side(style=&#x27;thin&#x27;),<br>        <span class="hljs-attribute">bottom</span>=Side(style=&#x27;thin&#x27;)<br>    )<br>    <br>    # 获取工作表的最大行数<br>    max_row = sheet.max_row<br>    <br>    # 遍历A-P列，从第1行到最后一行<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sheet.iter_rows(<span class="hljs-attribute">min_row</span>=1, <span class="hljs-attribute">max_row</span>=max_row, <br>                              <span class="hljs-attribute">min_col</span>=1, <span class="hljs-attribute">max_col</span>=16):  # <span class="hljs-attribute">A</span>=1, <span class="hljs-attribute">P</span>=16<br>        <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> row:<br>            # 应用字体<br>            cell.font = font  <br>            # 应用对齐<br>            cell.alignment = alignment        <br>            # 应用边框<br>            cell.border = thin_border<br><br>    # 遍历R-S列，从第1行到最后一行<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sheet.iter_rows(<span class="hljs-attribute">min_row</span>=2, <span class="hljs-attribute">max_row</span>=max_row, <br>                              <span class="hljs-attribute">min_col</span>=18, <span class="hljs-attribute">max_col</span>=19):  # <span class="hljs-attribute">A</span>=1, <span class="hljs-attribute">P</span>=16<br>        <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> row:<br>            # 应用字体<br>            cell.font = font<br>            # 应用对齐<br>            cell.alignment = alignment<br>            # 应用边框<br>            cell.border = thin_border    <br>    <br>    return sheet<br></code></pre></td></tr></table></figure>

<h3 id="输出文件的自动重命名机制"><a href="#输出文件的自动重命名机制" class="headerlink" title="输出文件的自动重命名机制"></a>输出文件的自动重命名机制</h3><p>当输出路径为空的时候，直接把输入路径加后缀变成输出路径。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">input_path = <span class="hljs-string">&quot;D:\表格.xlsx&quot;</span><br>output_path=<span class="hljs-literal">None</span><br><span class="hljs-comment"># 自动决定输出文件名</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> output_path:<br>    <span class="hljs-keyword">if</span> input_path.endswith(<span class="hljs-string">&#x27;.xlsx&#x27;</span>):<br>        output_path = input_path.replace(<span class="hljs-string">&#x27;.xlsx&#x27;</span>, <span class="hljs-string">&#x27;_processed.xlsx&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        output_path = input_path + <span class="hljs-string">&#x27;_processed.xlsx&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="字符串比较与清理空格"><a href="#字符串比较与清理空格" class="headerlink" title="字符串比较与清理空格"></a>字符串比较与清理空格</h3><p>在匹配字符串名称的时候，经常遇到需要判断字符串是否相同的情况。但考虑到数据多样性，有时候需要考虑模糊匹配，比如无视空格、无视大小写之类的。这种函数为了保证准确性，没有让AI来写，是自己编的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 输入字符串，清理其中的空格</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">strc</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(s, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> s:<br>        <span class="hljs-keyword">return</span> s<br>    <span class="hljs-keyword">return</span> s.replace(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>    <br><span class="hljs-comment"># 字符串比较不区分大小写</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">strcompare_lower</span>(<span class="hljs-params">a,b</span>):<br>    <span class="hljs-keyword">if</span> strc(a).lower() ==strc(b).lower():<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <br><span class="hljs-comment"># 字符串比较区分大小写</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">strcompare</span>(<span class="hljs-params">a,b</span>):<br>    <span class="hljs-keyword">if</span> strc(a) ==strc(b):<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<h3 id="在字符串中添加横线"><a href="#在字符串中添加横线" class="headerlink" title="在字符串中添加横线"></a>在字符串中添加横线</h3><p>这也是为了应对输入数据的多样性做的，手动模糊匹配。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 在字符串的第一个数字的后面添加横线，并且数字不能是第一个。</span><br><span class="hljs-comment"># ABC12 → ABC-12</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">adddash</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(s, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> s:<br>        <span class="hljs-keyword">return</span> s<br>    <span class="hljs-keyword">if</span> s[<span class="hljs-number">0</span>].isdigit():<br>        <span class="hljs-keyword">return</span> s<br>    <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;\d&#x27;</span>, s)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>        <span class="hljs-comment"># 在第一个数字前插入&#x27;-&#x27;</span><br>        pos = <span class="hljs-keyword">match</span>.start()<br>        <span class="hljs-keyword">return</span> s[:pos] + <span class="hljs-string">&#x27;-&#x27;</span> + s[pos:]<br><span class="hljs-comment"># 如果没有找到数字，原样返回</span><br>    <span class="hljs-keyword">return</span> s<br></code></pre></td></tr></table></figure>
<h3 id="批量清除横杠"><a href="#批量清除横杠" class="headerlink" title="批量清除横杠"></a>批量清除横杠</h3><p>批量清除字符串中第一个出现的横线。这个函数就完全是AI写的了，不得不说AI的效率就是高，一些简单的函数直接交给他写是正确的。但有时候他又会做一些多余的事，让代码变得很冗余，可能是我的交流方式不太对，应该多加一些限制词。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_first_hyphen_before_digits</span>(<span class="hljs-params">sheet</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    处理表格中的ID字段：移除第一次出现数字之前的第一个横杠</span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">    sheet: openpyxl Worksheet对象</span><br><span class="hljs-string">    返回:</span><br><span class="hljs-string">    处理后的Worksheet对象</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 定义检测和处理的函数</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_id</span>(<span class="hljs-params">id_str</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        处理单个ID字符串：只移除第一个数字前的第一个横杠</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(id_str, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> id_str:<br>            <span class="hljs-keyword">return</span> id_str<br>        <span class="hljs-comment"># 查找第一个数字的位置</span><br>        <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;\d&#x27;</span>, id_str)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>            <span class="hljs-keyword">return</span> id_str  <span class="hljs-comment"># 没有数字，直接返回</span><br>        first_digit_pos = <span class="hljs-keyword">match</span>.start()<br>        <span class="hljs-comment"># 在数字前部分查找第一个横杠的位置</span><br>        prefix = id_str[:first_digit_pos]<br>        hyphen_pos = prefix.find(<span class="hljs-string">&#x27;-&#x27;</span>)<br>        <span class="hljs-comment"># 如果找到横杠，只移除第一个横杠</span><br>        <span class="hljs-keyword">if</span> hyphen_pos != -<span class="hljs-number">1</span>:<br>            <span class="hljs-comment"># 构建新字符串：横杠前部分 + 横杠后部分 + 数字及之后部分</span><br>            new_prefix = prefix[:hyphen_pos] + prefix[hyphen_pos+<span class="hljs-number">1</span>:]<br>            <span class="hljs-keyword">return</span> new_prefix + id_str[first_digit_pos:]<br>        <span class="hljs-keyword">return</span> id_str<br>    <span class="hljs-comment"># 处理B列（第二列）的所有单元格</span><br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, sheet.max_row + <span class="hljs-number">1</span>):  <span class="hljs-comment"># 从第二行开始</span><br>        cell = sheet.cell(row=row, column=<span class="hljs-number">2</span>)  <span class="hljs-comment"># 第二列是B列</span><br>        <span class="hljs-comment"># 处理当前单元格的ID</span><br>        original_id = cell.value<br>        processed_id = process_id(original_id)<br>        <span class="hljs-comment"># 如果ID有变化，更新单元格值</span><br>        <span class="hljs-keyword">if</span> original_id != processed_id:<br>            cell.value = processed_id<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;行 <span class="hljs-subst">&#123;row&#125;</span>: &#x27;<span class="hljs-subst">&#123;original_id&#125;</span>&#x27; -&gt; &#x27;<span class="hljs-subst">&#123;processed_id&#125;</span>&#x27;&quot;</span>)<br>    <span class="hljs-keyword">return</span> sheet<br></code></pre></td></tr></table></figure>

<h3 id="检查几个参数的一行在数组中是否有重复数据"><a href="#检查几个参数的一行在数组中是否有重复数据" class="headerlink" title="检查几个参数的一行在数组中是否有重复数据"></a>检查几个参数的一行在数组中是否有重复数据</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 检查测量成果是否重复（三个参数同时重复）</span><br>def dataisonly(unique_id, y_str, x_str, data_array):<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">item</span> <span class="hljs-keyword">in</span> data_array:<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">item</span>[<span class="hljs-number">0</span>]) == unique_id <span class="hljs-keyword">and</span> (<span class="hljs-built_in">item</span>[<span class="hljs-number">1</span>]) == y_str <span class="hljs-keyword">and</span> (<span class="hljs-built_in">item</span>[<span class="hljs-number">2</span>]) == x_str ):<br><span class="hljs-built_in">            return</span> <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 如果未发现重复，则返回1</span><br><span class="hljs-built_in">    return</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h2 id="MDB数据库读取"><a href="#MDB数据库读取" class="headerlink" title="MDB数据库读取"></a>MDB数据库读取</h2><p>这里读取MDB使用的是pypyodbc库，需要先通过<code>pip install pypyodbc</code>在环境中安装该库。<br>功能直接让AI做了，而我只是写了相关功能的描述。AI用来写一些文件读写和简单逻辑功能是比较容易实现的，但如果遇到复杂的数学逻辑，最好还是自己来写核心计算公式。</p>
<blockquote>
<p>现在需要设计一个程序，检查排水管道数据中的问题，输入MDB数据库，其中有名称为管点调查表和管线调查表的两张表，需要检查其中的内容并在相同路径输出一个txt作为检查报告。<br>管线调查表记录的是每一段管线的数据，其中S_POINT字段是起点井名称，E_POINT是终点井名称，S_H是起点井面高程，E_H是终点井面高程，S_DEEP是起点埋设深度，E_DEEP是终点埋设深度。<br>管点表中，EXP_NO是井名称，SUR_H是井面高程。WellDeep是井深。<br>目前需要检查两项内容：1.是否有井的进水口低于出水口的情况。进水口高程是管线的终点井面-终点埋深，出水口高程是管线的起点井面-起点埋深。也就是说，根据点名匹配管线的连接关系，管线终点的高度如果低于下一段管线的起点，就要汇报异常2.是否有井深小于管深的情况，就是按照名称匹配将管表中起点和终点的埋设深度与井表的井深比较。如果有则在txt中报告异常井的名称、异常管道的两个节点、异常的偏差值。</p>
</blockquote>
<h2 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h2><p>关于图形界面其实之前做过，但是太久没做也是一点不记得了，还需要重新回顾一下。<br>python的图形界面库有许多，这里主要使用较为简单的tkinter库。</p>
<h3 id="主程序框架"><a href="#主程序框架" class="headerlink" title="主程序框架"></a>主程序框架</h3><p>搭建主程序的代码还是比较长的，这里就不全部复制粘贴了，但是整个程序的框架还是有必要记录一下。<br>总体来看，主界面程序的构成非常简单：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># 各种功能模块的导入</span><br><span class="hljs-meta"># 主界面类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span>(tk.Tk)<br><span class="hljs-meta"># 文件运行指令</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span><br></code></pre></td></tr></table></figure>
<p>当py文件作为程序直接运行的时候，就会执行当前文件做主程序的代码。这一段代码一般放在程序的最后。</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-keyword">if</span> <span class="hljs-attr">__name__</span> == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 添加时间处理函数所需的模块</span><br>    <span class="hljs-built_in">import</span> time<br>    <br>    <span class="hljs-comment"># 创建并运行应用程序</span><br>    <span class="hljs-attr">app</span> = Application()<br>    app.mainloop()<br></code></pre></td></tr></table></figure>
<p>主界面由一个类构成，其中有许多的页面和功能函数。当进入该类的时候，会执行__init__初始化方法中的指令。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span>(tk.Tk):<br>    <span class="hljs-string">&quot;&quot;&quot;主应用程序窗口&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.title(<span class="hljs-string">&quot;管网工具v1.1&quot;</span>)<br>        self.geometry(<span class="hljs-string">&quot;800x600&quot;</span>)<br>        self.resizable(<span class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)<br>        <br>        <span class="hljs-comment"># 创建日志区域</span><br>        self.create_log_widget()<br>        <br>        <span class="hljs-comment"># 创建功能选项卡</span><br>        self.create_tabs()<br>        <br>        <span class="hljs-comment"># 初始化日志</span><br>        self.log(<span class="hljs-string">&quot;应用程序启动&quot;</span>)<br>        self.log(<span class="hljs-string">f&quot;当前时间: <span class="hljs-subst">&#123;datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-comment"># 启动命令行窗口</span><br>        self.start_command_window()<br></code></pre></td></tr></table></figure>

<h3 id="让AI写界面"><a href="#让AI写界面" class="headerlink" title="让AI写界面"></a>让AI写界面</h3><p>现在人工智能已经十分发达，前端这种麻烦又复杂的工作完全可以交给AI，而我只需要保证核心的算法不出问题就可以了,并不需要关心太多繁琐的不重要的细节问题。</p>
<h4 id="自然语言输入"><a href="#自然语言输入" class="headerlink" title="自然语言输入"></a>自然语言输入</h4><blockquote>
<p>之前的任务已经完成，现在我的主要程序和各类分支功能基本上已经写好了，但是我还想要做一个简单的界面，运行主程序后，启动一个界面框，同时启动命令行框。各种功能主要的运作方式就是输入文件地址，然后按一个按钮运行，所以我需要做一些文件路径读取框和一些启动按钮。下面介绍一下各种功能。数据库转成果表：需要输入埋深表xls路径、坐标表csv路径、参考模板xlsx表路径；成果表批量转数据库：需要输入成果表文件夹路径，埋深表模板路径；坡比自动调整：需要输入成果表路径。<br>我还需要添加三个功能卡片：读取设计数据：需要输入一个设计表xlsx的路径，然后按按钮运行；读取施工数据：需要输入一个设计施工对比表模板xlsx，一个成果表xlsx，按按钮运行；数据对照表生成：需要输入一个读取后的成果表xlsx，一个读取后的设计表xlsx，按按钮运行。不需要向我展示整个程序，只需要说明增加的部分。</p>
</blockquote>
<h4 id="得到的程序界面"><a href="#得到的程序界面" class="headerlink" title="得到的程序界面"></a>得到的程序界面</h4><p><img src="/2025/09/30/python%E5%BC%80%E5%8F%91%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E5%B7%A5%E5%85%B7/813bb752ff9a25f2d29a3b03ba95d5ad.png" srcset="/img/loading.gif" lazyload alt="813bb752ff9a25f2d29a3b03ba95d5ad.png"></p>
<h3 id="选项卡分类"><a href="#选项卡分类" class="headerlink" title="选项卡分类"></a>选项卡分类</h3><p>随着功能越添越多，选项卡一行都塞不下了，这样用起来也不方便，于是问了一下AI，搞了个选项卡分组。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 创建三个主分类</span><br>tab_group1 = ttk.Frame(tab_control)<br>tab_group2 = ttk.Frame(tab_control)<br>tab_group3 = ttk.Frame(tab_control)<br><br>tab_control.<span class="hljs-built_in">add</span>(tab_group1, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;成果表处理&quot;</span>)<br>tab_control.<span class="hljs-built_in">add</span>(tab_group2, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;对比表生成&quot;</span>)<br>tab_control.<span class="hljs-built_in">add</span>(tab_group3, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;MDB处理&quot;</span>)<br><br><span class="hljs-comment"># --- 成果表处理子选项卡 ---</span><br>subtabs1 = ttk.Notebook(tab_group1)<br>tab1 = ttk.Frame(subtabs1)  # 数据库转成果表<br>tab2 = ttk.Frame(subtabs1)  # 成果表批量转数据库<br>tab3 = ttk.Frame(subtabs1)  # 坡比预处理<br>tab4 = ttk.Frame(subtabs1)  # 坡比自动调整<br>tab5 = ttk.Frame(subtabs1)  # 断面图生成<br>subtabs1.<span class="hljs-built_in">add</span>(tab1, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;数据库转成果表&quot;</span>)<br>subtabs1.<span class="hljs-built_in">add</span>(tab2, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;成果表批量转数据库&quot;</span>)<br>subtabs1.<span class="hljs-built_in">add</span>(tab3, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;坡比预处理&quot;</span>) <br>subtabs1.<span class="hljs-built_in">add</span>(tab4, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;坡比自动调整&quot;</span>)<br>subtabs1.<span class="hljs-built_in">add</span>(tab5, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;断面图绘制&quot;</span>)<br>subtabs1.pack(<span class="hljs-attribute">expand</span>=1, <span class="hljs-attribute">fill</span>=<span class="hljs-string">&quot;both&quot;</span>)<br><br><span class="hljs-comment"># --- 对比表生成子选项卡 ---</span><br>subtabs2 = ttk.Notebook(tab_group2)<br>tab6 = ttk.Frame(subtabs2)  # 读取设计数据<br>tab7 = ttk.Frame(subtabs2)  # 读取施工数据<br>tab8 = ttk.Frame(subtabs2)  # 数据对照表生成<br>tab11 = ttk.Frame(subtabs2) # 施工与设计对比<br>tab12 = ttk.Frame(subtabs2) # 深度不足整改<br>tab13 = ttk.Frame(subtabs2) # 生成对比图<br>subtabs2.<span class="hljs-built_in">add</span>(tab6, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;读取设计数据&quot;</span>)       # 新增<br>subtabs2.<span class="hljs-built_in">add</span>(tab7, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;读取施工数据&quot;</span>)       # 新增<br>subtabs2.<span class="hljs-built_in">add</span>(tab8, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;数据对照表生成&quot;</span>)     # 新增<br>subtabs2.<span class="hljs-built_in">add</span>(tab11, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;施工与设计对比&quot;</span>)<br>subtabs2.<span class="hljs-built_in">add</span>(tab12, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;超限自动调整bate&quot;</span>)<br>subtabs2.<span class="hljs-built_in">add</span>(tab13, <span class="hljs-attribute">text</span>=<span class="hljs-string">&quot;生成对比图&quot;</span>)<br>subtabs2.pack(<span class="hljs-attribute">expand</span>=1, <span class="hljs-attribute">fill</span>=<span class="hljs-string">&quot;both&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>分组之后，界面看起来整洁了一些。<br><img src="/2025/09/30/python%E5%BC%80%E5%8F%91%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E5%B7%A5%E5%85%B7/670191cfad10c4ed68ba168ccb34ac83.png" srcset="/img/loading.gif" lazyload alt="670191cfad10c4ed68ba168ccb34ac83.png"></p>
<h2 id="关于运行环境"><a href="#关于运行环境" class="headerlink" title="关于运行环境"></a>关于运行环境</h2><p>主程序代码是放在\app\src路径下的，而各种功能模块则放在\app\src\modules中，为了能够让VScode能够在运行的时候能够识别到文件夹里的子模块，一般会有一个\app\src.vscode文件夹，需要在其中的settings.json文件中添加modules文件夹路径，才能让VScode在运行主程序的时候能够识别到子模块。<br>以下是setting.json的内容。</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>    <span class="hljs-string">&quot;python.analysis.extraPaths&quot;</span>: [<br>        <span class="hljs-string">&quot;./modules&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;python.autoComplete.extraPaths&quot;</span>: [<br>        <span class="hljs-string">&quot;./modules&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;python.linting.pylintArgs&quot;</span>: [<br>        <span class="hljs-string">&quot;--init-hook&quot;</span>,<br>        <span class="hljs-string">&quot;import sys; sys.path.append(&#x27;./modules&#x27;)&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;python.formatting.autopep8Args&quot;</span>: [<br>        <span class="hljs-string">&quot;--ignore=E402&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;python.analysis.exclude&quot;</span>: [<br>        <span class="hljs-string">&quot;**/__pycache__&quot;</span>,<br>        <span class="hljs-string">&quot;**/.pytest_cache&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;python.defaultInterpreterPath&quot;</span>: <span class="hljs-string">&quot;python&quot;</span>,<br>    <span class="hljs-string">&quot;editor.formatOnSave&quot;</span>: true,<br>    <span class="hljs-string">&quot;files.autoSave&quot;</span>: <span class="hljs-string">&quot;afterDelay&quot;</span>,<br>    <span class="hljs-string">&quot;python.languageServer&quot;</span>: <span class="hljs-string">&quot;Pylance&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="程序打包"><a href="#程序打包" class="headerlink" title="程序打包"></a>程序打包</h1><h2 id="使用PyInstaller打包的方法"><a href="#使用PyInstaller打包的方法" class="headerlink" title="使用PyInstaller打包的方法"></a>使用PyInstaller打包的方法</h2><p>不知为何直接使用PyInstaller+py程序的方式打包的时候会报错，这里使用了AI提供的方案，通过spec文件来打包的方式。spec文件放在最外面，主程序放在src文件夹中，而其他的子模块放在src/modules文件夹。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># -*- mode: python ; coding: utf-8 -*-</span><br><br>block_cipher = None<br><br>a = Analysis(<br>    # 主程序路径（从spec文件所在目录出发的相对路径）<br>    [<span class="hljs-string">&#x27;src/deepseek_python_main.py&#x27;</span>],<br>    # 添加模块搜索路径（确保能找到自定义模块）<br>    pathex=[<span class="hljs-string">&#x27;./src&#x27;</span>],  # 关键路径设置<br>    binaries=[],<br>    # 包含模板文件夹（元组格式：(源路径, 打包后虚拟路径)）<br>    datas=[(<span class="hljs-string">&#x27;template/*&#x27;</span>, <span class="hljs-string">&#x27;template&#x27;</span>)],  # 包含模板资源<br>    hiddenimports=[],  # 如果有动态导入的模块需要手动添加<br>    hookspath=[],<br>    hooksconfig=&#123;&#125;,<br>    runtime_hooks=[],<br>    excludes=[],<br>    <span class="hljs-attribute">win_no_prefer_redirects</span>=<span class="hljs-literal">False</span>,<br>    <span class="hljs-attribute">win_private_assemblies</span>=<span class="hljs-literal">False</span>,<br>    <span class="hljs-attribute">cipher</span>=block_cipher,<br>    <span class="hljs-attribute">noarchive</span>=<span class="hljs-literal">False</span>,<br>)<br><br><span class="hljs-comment"># 单文件打包配置</span><br>pyz = PYZ(a.pure, a.zipped_data, <span class="hljs-attribute">cipher</span>=block_cipher)<br><br>exe = EXE(<br>    pyz,<br>    a.scripts,<br>    a.binaries,<br>    a.zipfiles,<br>    a.datas,<br>    # 以下为输出配置<br>    <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;main&#x27;</span>,          # 生成的exe名称<br>    <span class="hljs-attribute">debug</span>=<span class="hljs-literal">False</span>,          # 是否包含调试信息<br>    <span class="hljs-attribute">bootloader_ignore_signals</span>=<span class="hljs-literal">False</span>,<br>    <span class="hljs-attribute">strip</span>=<span class="hljs-literal">False</span>,<br>    <span class="hljs-attribute">upx</span>=<span class="hljs-literal">True</span>,             # 启用UPX压缩（需安装UPX）<br>    <span class="hljs-attribute">runtime_tmpdir</span>=None,<br>    <span class="hljs-attribute">console</span>=<span class="hljs-literal">True</span>,         # 是否显示控制台窗口<br>    <span class="hljs-attribute">disable_windowed_traceback</span>=<span class="hljs-literal">False</span>,<br>    <span class="hljs-attribute">argv_emulation</span>=<span class="hljs-literal">False</span>,<br>    <span class="hljs-attribute">target_arch</span>=None,<br>    <span class="hljs-attribute">codesign_identity</span>=None,<br>    <span class="hljs-attribute">entitlements_file</span>=None,<br>    <span class="hljs-attribute">icon</span>=None             # 可设置图标路径如 <span class="hljs-string">&#x27;src/icon.ico&#x27;</span><br>)<br></code></pre></td></tr></table></figure>

<p>打包之前需要注意，除了修改程序的功能代码，还要修改显示在主程序中的版本号、打包工具的参数等。</p>
<p>最后执行pyinstaller打包程序，就可以导出exe程序了。这里导出的结果是一个exe文件。打包过程创建的文件在build文件夹中，打包结果在dist文件夹里。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">python -m PyInstaller app.<span class="hljs-keyword">spec</span><br></code></pre></td></tr></table></figure>

<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><p>同事反馈数据库转成果表不成功，看到命令行里有关于float的报错，我一猜就知道大概率是数据有问题，但大海捞针并不好找，还是要查一下报错原因。</p>
<blockquote>
<p>出现异常: ‘float’ object has no attribute ‘lower’<br>在Python中，当你遇到错误信息 ‘float’ object has no attribute ‘lower’，这意味着你尝试在一个浮点数（float）对象上调用lower()方法，而float类型的对象并不拥有这个方法。lower()方法是字符串（str）类型的一个方法，用于将字符串中的所有字符转换为小写。</p>
</blockquote>
<p>考虑到这行代码使用的对象，应该是判断名字的，后来检查数据发现，是有一行数据名字是空的，所以才会出现这个报错。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这次临时项目，也是花了我两个星期的时间，从一开始的摸索，到程序越来越庞大，代码管理遇到困难，也是亲身体验了一下程序构建的过程。其实还有很多可以优化的地方，比如把各种临时造的工具函数拆出去保存到其他文件，只保留主程序，做好代码复用；比如完善一下异常处理机制；甚至做一下程序界面，通过界面交互等更方便的方式读取文件路径等。但这些终究还是暂时靠边放了，一切为实现目的服务，而能够写代码的只有我自己而已，还是把精力先放在核心功能函数上。光是思考核心逻辑和调试参数，就已经精疲力竭了。到最后调坡比的代码都长到600行了。</p>
<p>PS：项目是7月份就开始做的，代码一直维护到了9月份，后来又经过几轮新增功能，代码越来越长，还让公司拿去申请软件著作了。搞开发还是挺有意思的，当然这是野路子，正经开发有一堆的规则要遵守，非常麻烦。现在AI越来越发达，很多简单的代码其实可以直接丢给AI实现，不需要非常过硬的编程功底。但程序设计的思维还是要有的，哪怕只是一点，也足以超越完全不去了解程序的普通人。</p>
<p>最后是源码的备份<br><a href="%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91%E6%BA%90%E7%A0%81%E5%A4%87%E4%BB%BDsrc20250930.7z">雨污管网源码备份src20250930.7z</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0/" class="category-chain-item">学习</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/python/">#python</a>
      
        <a href="/tags/%E5%BC%80%E5%8F%91/">#开发</a>
      
        <a href="/tags/%E5%B7%A5%E5%85%B7/">#工具</a>
      
        <a href="/tags/%E9%9B%A8%E6%B1%A1%E7%AE%A1%E7%BD%91/">#雨污管网</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>python开发雨污管网工具</div>
      <div>http://kw1649190133.github.io/2025/09/30/python开发雨污管网工具/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Beitragsautor</div>
          <div>Kwindy</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Veröffentlicht am</div>
          <div>September 30, 2025</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Urheberrechtshinweis</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2026/01/15/%E9%80%9A%E8%BF%87WSL%E8%BF%90%E8%A1%8CPX4%E7%9A%84AirSim%E4%BB%BF%E7%9C%9F/" title="通过WSL运行PX4的AirSim仿真">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">通过WSL运行PX4的AirSim仿真</span>
                        <span class="visible-mobile">Vorheriger</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/09/30/switch%E7%A0%B4%E8%A7%A3%E6%9C%BA%E5%88%B7%E7%B3%BB%E7%BB%9F/" title="switch破解机刷系统">
                        <span class="hidden-mobile">switch破解机刷系统</span>
                        <span class="visible-mobile">Nächster</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Inhaltsverzeichnis</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Suchen</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Stichwort</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog funktioniert am besten mit aktiviertem JavaScript</div>
  </noscript>
</body>
</html>
